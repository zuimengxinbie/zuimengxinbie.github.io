---
title: ã€JavaScriptã€‘- è®¾è®¡æ¨¡å¼
date: 2022-01-02 00:00:00
sidebar: auto
sticky: false
permalink: /pages/ts220102/
categories:
  - æŠ€æœ¯
tags:
  - ts
---

<p align="center">
  <img width="500" src="https://p16.qhimg.com/dmfd/2560_1440_/t01b0d27088a888dfaf.jpg"/>
</p>

> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ ğŸŒ¹ğŸŒ¹ğŸŒ¹
>
> <!-- more -->

# è®¾è®¡æ¨¡å¼

## æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æ¨¡å¼

æ¨¡å¼æ˜¯ä¸€ç§å¯å¤ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œå¯ç”¨äºè§£å†³è½¯ä»¶è®¾è®¡ä¸­é‡åˆ°çš„å¸¸è§é—®é¢˜ã€‚

### æ¨¡å¼çš„ä¼˜ç‚¹

- å¤ç”¨æ¨¡å¼æœ‰åŠ©äºé˜²æ­¢åœ¨åº”ç”¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­å°é—®é¢˜å¼•å‘å¤§é—®é¢˜
- æ¨¡å¼å¯ä»¥æä¾›é€šç”¨çš„è§£å†³æ–¹æ¡ˆ
- æŸäº›æ¨¡å¼å¯ä»¥é€šè¿‡é¿å…ä»£ç å¤ç”¨å‡å°‘ä»£ç çš„æ€»ä½“èµ„æºå ç”¨é‡
- æ¨¡å¼ä¼šä½¿å¼€å‘æ²Ÿé€šæ›´å¿«é€Ÿ
- æ¨¡å¼å¯ä»¥é€æ­¥æ”¹è¿›

### è®¾è®¡æ¨¡å¼çš„ç»“æ„

- æ¨¡å¼åç§°
- æè¿°
- ä¸Šä¸‹æ–‡å¤§çº²
- é—®é¢˜é™ˆè¿°
- è§£å†³æ–¹æ¡ˆ
- è®¾è®¡
- å®ç°
- æ’å›¾
- ç¤ºä¾‹
- è¾…åŠ©æ¡ä»¶
- å…³ç³»
- å·²çŸ¥çš„ç”¨æ³•
- è®¨è®º

### åæ¨¡å¼

JavaScript ä¸­çš„åæ¨¡å¼ç¤ºä¾‹å¦‚ä¸‹

- åœ¨å…¨å±€ä¸Šä¸‹æ–‡ä¸­å®šä¹‰å¤§é‡çš„å˜é‡æ±¡æŸ“å…¨å±€å‘½åç©ºé—´
- å‘ setTimeout æˆ– setInterval ä¼ é€’å­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å‡½æ•°
- ä¿®æ”¹ Object ç±»çš„åŸå‹
- ä»¥å†…è”å½¢å¼ä½¿ç”¨ JavaScript
- ä½¿ç”¨ document.write

### è®¾è®¡æ¨¡å¼çš„ç±»åˆ«

#### åˆ›å»ºå‹

ä¸“æ³¨äºå¤„ç†å¯¹è±¡åˆ›å»ºæœºåˆ¶ï¼Œä»¥é€‚åˆç»™å®šæƒ…å†µçš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ã€‚åˆ›å»ºå¯¹è±¡çš„åŸºæœ¬æ–¹æ³•å¯èƒ½å¯¼è‡´é¡¹ç›®å¤æ‚æ€§å¢åŠ ï¼Œè€Œåˆ›å»ºå‹æ¨¡å¼æ—¨åœ¨é€šè¿‡æ§åˆ¶åˆ›å»ºè¿‡ç¨‹æ¥è§£å†³è¿™ç§é—®é¢˜ã€‚

| è®¾è®¡æ¨¡å¼            | æè¿° |
| :------------------ | :--: |
| Constructor(æ„é€ å™¨) |      |
| Factory(å·¥å‚)       |      |
| Abstract(æŠ½è±¡)      |      |
| Prototype(åŸå‹)     |      |
| Singleton(å•ä¾‹)     |      |
| Singleton(å•ä¾‹)     |      |
| Builder(ç”Ÿæˆå™¨)     |      |

#### ç»“æ„å‹

ç»“æ„å‹ä¸å¯¹è±¡ç»„åˆæœ‰å…³ï¼Œé€šå¸¸å¯ä»¥ç”¨äºæ‰¾å‡ºåœ¨ä¸åŒå¯¹è±¡ä¹‹é—´å»ºç«‹å…³ç³»çš„ç®€å•æ–¹æ³•ã€‚è¿™ç§æ¨¡å¼æœ‰åŠ©äºç¡®ä¿åœ¨ç³»ç»ŸæŸä¸€éƒ¨åˆ†å‘ç”Ÿå˜åŒ–æ—¶ï¼Œç³»ç»Ÿçš„æ•´ä¸ªç»“æ„ä¸éœ€è¦åŒæ—¶æ”¹å˜ï¼ŒåŒæ—¶å¯¹äºä¸é€‚åˆæŸä¸€ç‰¹å®šç›®çš„è€Œæ”¹å˜çš„ç³»ç»Ÿéƒ¨åˆ†ï¼Œä¹Ÿèƒ½å¤Ÿå®Œæˆé‡ç»„ã€‚

| è®¾è®¡æ¨¡å¼         | æè¿° |
| :--------------- | :--: |
| Iterator(è£…é¥°è€…) |      |
| Facade(å¤–è§‚)     |      |
| Flyweight(äº«å…ƒ)  |      |
| Adapter(é€‚é…å™¨)  |      |
| Proxy(ä»£ç†)      |      |

#### è¡Œä¸º

è¡Œä¸ºè®¾è®¡æ¨¡å¼ä¸“æ³¨äºæ”¹å–„æˆ–ç®€åŒ–ç³»ç»Ÿä¸­ä¸åŒå¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚

| è®¾è®¡æ¨¡å¼         | æè¿° |
| :--------------- | :--: |
| Iterator(è¿­ä»£å™¨) |      |
| Mediator(ä¸­ä»‹è€…) |      |
| Observer(è§‚å¯Ÿè€…) |      |
| Visitor(è®¿é—®è€…)  |      |

## Constructor(æ„é€ å™¨)æ¨¡å¼

```javascript
function Person() {}
var person = new Person();

// å¸¦åŸå‹çš„Constructor
Person.prototype.getName = {};
```

## Module(æ¨¡å—)æ¨¡å¼

- å¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ³•
- Module æ¨¡å¼
- AMD æ¨¡å¼
- CommonJS æ¨¡å—
- ECMAScript Harmony æ¨¡å—

### å¯¹è±¡å­—é¢é‡è¡¨ç¤ºæ³•

```javascript
let person = {
  name: '',
  age: 0,
  getName: function () {},
  getAge: function () {},
};
```

### Module æ¨¡å¼

Module æ¨¡å¼å¯ä»¥ä¸ºç±»æä¾›ç§æœ‰å’Œå…¬æœ‰çš„æ–¹æ³•ï¼ŒModule æ¨¡å¼ä¼šå°è£…ä¸€ä¸ªä½œç”¨åŸŸï¼Œä»è€Œå±è”½æ¥è‡ªå…¨å±€ä½œç”¨åŸŸçš„ç‰¹æ®Šéƒ¨åˆ†ï¼Œä½¿ä¸€ä¸ªå•ç‹¬çš„å¯¹è±¡æ‹¥æœ‰å…¬æœ‰/ç§æœ‰çš„æ–¹æ³•å’Œå˜é‡ã€‚

Module æ¨¡å¼ä½¿ç”¨é—­åŒ…å°è£…ç§æœ‰çŠ¶æ€å’Œç»„ç»‡ï¼Œæä¾›ä¸€ç§åŒ…è£…æ··åˆå…¬æœ‰/ç§æœ‰æ–¹æ³•å’Œå˜é‡çš„æ–¹å¼ï¼Œé˜²æ­¢å…¶æ³„éœ²è‡³å…¨å±€ä½œç”¨åŸŸï¼Œé˜²æ­¢ä¸å…¨å±€ä½œç”¨åŸŸä¸­çš„æ–¹æ³•å’Œå˜é‡å‘ç”Ÿå†²çªã€‚é€šè¿‡è¯¥æ¨¡å¼åªéœ€è¿”å›ä¸€ä¸ªå…¬æœ‰ APIï¼Œè€Œå…¶ä»–çš„ä¸€åˆ‡åˆ™éƒ½ç»´æŒåœ¨ç§æœ‰é—­åŒ…é‡Œã€‚

Module æ¨¡å¼å¯ä»¥å±è”½å¤„ç†åº•å±‚äº‹ä»¶é€»è¾‘ï¼Œåªæš´éœ²ä¾›åº”ç”¨ç¨‹åºè°ƒç”¨çš„å…¬æœ‰ APIï¼Œè¯¥æ¨¡å¼è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡è€Œä¸æ˜¯å‡½æ•°ã€‚

```javascript
// ä¸€ä¸ªç«‹å³æ‰§è¡Œçš„åŒ¿åå‡½æ•°åˆ›å»ºäº†ä¸€ä¸ªä½œç”¨åŸŸ
// å…¨å±€ä½œç”¨åŸŸæ— æ³•è·å–ç§æœ‰å˜é‡_counter
var moduleMode = (function () {
  // ç§æœ‰å˜é‡
  var _counter = 0;

  // è¿”å›ä¸€ä¸ªå…¬æœ‰å¯¹è±¡
  return {
    // å…¬æœ‰API
    increment: function () {
      return ++_counter;
    },
    // å…¬æœ‰API
    reset: function () {
      _counter = 0;
      return _counter;
    },
  };
})();

let counter = moduleMode.increment();
console.log(counter);
counter = moduleMode.increment();
console.log(counter);
counter = moduleMode.reset();
console.log(counter);
// _counter is not defined
console.log(_counter);
```

> Module æ¨¡å¼çš„æœ¬è´¨æ˜¯ä½¿ç”¨å‡½æ•°ä½œç”¨åŸŸæ¥æ¨¡æ‹Ÿç§æœ‰å˜é‡ï¼Œåœ¨æ¨¡å¼å†…ï¼Œç”±äºé—­åŒ…çš„å­˜åœ¨ï¼Œå£°æ˜çš„å˜é‡å’Œæ–¹æ³•æ—¨åœ¨æ”¹æ¨¡å¼å†…éƒ¨å¯ç”¨ï¼Œä½†åœ¨è¿”å›å¯¹è±¡ä¸Šå®šä¹‰çš„å˜é‡å’Œæ–¹æ³•ï¼Œåˆ™å¯¹å¤–éƒ¨ä½¿ç”¨è€…å¯ç”¨ã€‚

Module æ¨¡å¼ä¹Ÿå¯ç”¨äºå‘½åç©ºé—´

```javascript
var Namespace = (function () {
  // ç§æœ‰å˜é‡
  var _counter = 0;

  // ç§æœ‰æ–¹æ³•
  var _sayCounter = function () {
    console.log(_counter);
  };

  // è¿”å›ä¸€ä¸ªå…¬æœ‰å¯¹è±¡
  return {
    // å…¬æœ‰å˜é‡
    counter: 10,

    // å…¬æœ‰API
    increment: function () {
      ++_counter;
      // è°ƒç”¨ç§æœ‰å˜é‡
      _sayCounter();
      return _counter;
    },
    // å…¬æœ‰API
    reset: function () {
      _counter = 0;
      _sayCounter();
      return _counter;
    },
  };
})();

Namespace.increment();
Namespace.increment();
Namespace.reset();
```

### Module æ¨¡å¼çš„å˜åŒ–

#### å¼•å…¥

å¯ä»¥ä½¿ jQueryã€Underscore ä½œä¸ºå‚æ•°å¼•å…¥æ¨¡å—

```javascript
var moduleMode = (function ($, _) {
  function _method() {
    $('.container').html('test');
  }

  return {
    method: function () {
      _method();
    },
  };
})($, _);

moduleMode.method();
```

#### å¼•å‡º

```javascript
let moduleMode = (function () {
  var public = {},
    _private = 'hello';

  function _method() {
    console.log(_private);
  }

  public.name = 'public';

  public.method = function () {
    _method();
  };

  return public;
})();

console.log(moduleMode.name);
```

### Module æ¨¡å¼çš„ä¼˜ç¼ºç‚¹

- ä¼˜ç‚¹ï¼šæ•´æ´ã€æ”¯æŒç§æœ‰æ•°æ®ã€‚
- ç¼ºé™·ï¼šç§æœ‰æ•°æ®éš¾ä»¥ç»´æŠ¤ï¼ˆæƒ³æ”¹å˜å¯è§æ€§éœ€è¦ä¿®æ”¹æ¯ä¸€ä¸ªä½¿ç”¨è¯¥ç§æœ‰æ•°æ®çš„åœ°æ–¹ï¼‰ï¼Œæ— æ³•ä¸ºç§æœ‰æˆå‘˜åˆ›å»ºè‡ªåŠ¨åŒ–å•å…ƒæµ‹è¯•ï¼Œå¼€å‘äººå‘˜æ— æ³•è½»æ˜“æ‰©å±•ç§æœ‰æ–¹æ³•ã€‚

## Singleton(å•ä¾‹/å•ä½“)æ¨¡å¼

å•ä¾‹æ¨¡å¼ä½œä¸ºä¸€ä¸ªé™æ€çš„å®ä¾‹å®ç°æ—¶ï¼Œå¯ä»¥å»¶è¿Ÿåˆ›å»ºå®ä¾‹ï¼Œä»è€Œåœ¨æ²¡æœ‰ä½¿ç”¨è¯¥é™æ€å®ä¾‹ä¹‹å‰ï¼Œæ— éœ€å ç”¨æµè§ˆå™¨çš„èµ„æºæˆ–å†…å­˜ã€‚åŒæ—¶å½“åœ¨ç³»ç»Ÿä¸­ç¡®å®éœ€è¦ä¸€ä¸ªå¯¹è±¡æ¥åè°ƒå…¶ä»–å¯¹è±¡æ—¶ï¼ŒSingleton æ¨¡å¼éå¸¸æœ‰ç”¨ã€‚å•ä¾‹æ¨¡å¼å¯ä»¥æ¨è¿Ÿåˆå§‹åŒ–ï¼Œé€šå¸¸æ˜¯å› ä¸ºå®ƒéœ€è¦ä¸€äº›ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯åœ¨åˆå§‹åŒ–æœŸé—´å¯èƒ½æ— æ³•è·å¾—ã€‚

```javascript
var Singleton = (function () {
  function Single(options) {
    options = options || {};
    this.name = options.name || 'Single';
    this.age = options.age || 1;
  }

  var _instance;

  // è¿”å›ä¸€ä¸ªé—­åŒ…ï¼Œ_instanceä¸ä¼šè¢«é”€æ¯
  return {
    name: 'Singleton',
    getInstance: function (options) {
      if (!_instance) {
        _instance = new Single(options);
      }
      return _instance;
    },
  };
})();

var single = Singleton.getInstance({
  name: 'ziyi2',
  age: 28,
});

// Single {name: "ziyi2", age: 28}
console.log(single);
```

## Observer(è§‚å¯Ÿè€…)æ¨¡å¼

è§‚å¯Ÿè€…æ¨¡å¼æ˜¯ä½¿ç”¨ä¸€ä¸ª subject ç›®æ ‡å¯¹è±¡ç»´æŒä¸€ç³»åˆ—ä¾èµ–äºå®ƒçš„ observer è§‚å¯Ÿè€…å¯¹è±¡ï¼Œå°†æœ‰å…³çŠ¶æ€çš„ä»»ä½•å˜æ›´è‡ªåŠ¨é€šçŸ¥ç»™è¿™ä¸€ç³»åˆ—è§‚å¯Ÿè€…å¯¹è±¡ã€‚å½“ subject ç›®æ ‡å¯¹è±¡éœ€è¦å‘Šè¯‰è§‚å¯Ÿè€…å‘ç”Ÿäº†ä»€ä¹ˆäº‹æƒ…æ—¶ï¼Œå®ƒä¼šå‘è§‚å¯Ÿè€…å¯¹è±¡ä»¬å¹¿æ’­ä¸€ä¸ªé€šçŸ¥ã€‚

> ä¸€ä¸ªæˆ–å¤šä¸ªè§‚å¯Ÿè€…å¯¹ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€æ„Ÿå…´è¶£æ—¶ï¼Œå¯ä»¥å°†è‡ªå·±ä¾é™„åœ¨ç›®æ ‡å¯¹è±¡ä¸Šä»¥ä¾¿æ³¨å†Œæ„Ÿå…´è¶£çš„ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å˜åŒ–ï¼Œç›®æ ‡å¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜å°±ä¼šå‘é€ä¸€ä¸ªé€šçŸ¥æ¶ˆæ¯ï¼Œè°ƒç”¨æ¯ä¸ªè§‚å¯Ÿè€…çš„æ›´æ–°æ–¹æ³•ã€‚å¦‚æœè§‚å¯Ÿè€…å¯¹ç›®æ ‡å¯¹è±¡çš„çŠ¶æ€ä¸æ„Ÿå…´è¶£ï¼Œä¹Ÿå¯ä»¥å°†è‡ªå·±ä»ä¸­åˆ†ç¦»ã€‚

| å¯¹è±¡                     | æè¿°                                                   |
| :----------------------- | :----------------------------------------------------- |
| Subject(ç›®æ ‡)            | ç»´æŠ¤ä¸€ç³»åˆ—çš„è§‚å¯Ÿè€…ï¼Œæ–¹ä¾¿æ·»åŠ ã€åˆ é™¤å’Œé€šçŸ¥è§‚å¯Ÿè€…         |
| Observer(è§‚å¯Ÿè€…)         | ä¸ºé‚£äº›ç›®æ ‡çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶éœ€è¦é€šçŸ¥çš„å¯¹è±¡æä¾›ä¸€ä¸ªæ›´æ–°æ¥å£ |
| subject(ç›®æ ‡)å®ä¾‹å¯¹è±¡    | çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶é€šçŸ¥è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ä»¬æ›´æ–°çŠ¶æ€             |
| observer(è§‚å¯Ÿè€…)å®ä¾‹å¯¹è±¡ | å®ç°æ›´æ–°æ¥å£ç”¨äºæ›´æ–°çŠ¶æ€                               |

![è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼](https://raw.githubusercontent.com/ziyi2/js/master/images/Observer.png)

### è§‚å¯Ÿè€…åˆ—è¡¨å¯¹è±¡

è§‚å¯Ÿè€…åˆ—è¡¨å¯¹è±¡ç”¨äºç»´æŠ¤ä¸€ç³»åˆ—çš„è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡

```javascript
// è§‚å¯Ÿè€…åˆ—è¡¨å¯¹è±¡
function ObserverList() {
  this.observerList = [];
}

// å¢åŠ è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡
ObserverList.prototype.add = function (observer) {
  return this.observerList.push(observer);
};

// æŸ¥çœ‹è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡çš„æ•°é‡
ObserverList.prototype.getCount = function () {
  return this.observerList.length;
};

// è·å–æŸä¸ªè§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡
ObserverList.prototype.get = function (index) {
  if (index < -1 || index > this.observerList.length) return;
  return this.observerList[index];
};

// åˆ æ”¹è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡çš„åˆ—è¡¨ çœç•¥...
```

### Subject(ç›®æ ‡)å¯¹è±¡

ä½¿ç”¨è§‚å¯Ÿè€…åˆ—è¡¨å¯¹è±¡ç»´æŠ¤è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ï¼Œå¹¶å¯ä»¥é€šçŸ¥è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡æ›´æ–°çŠ¶æ€

```javascript
// ç›®æ ‡å¯¹è±¡ï¼ˆåœ¨è§‚å¯Ÿè€…åˆ—è¡¨ä¸Šå¢ã€åˆ è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ï¼‰
function Subject() {
  this.observers = new ObserverList();
}

// å¢åŠ è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡
Subject.prototype.add = function (observer) {
  this.observers.add(observer);
};

// é€šçŸ¥è§‚å¯Ÿè€…åˆ—è¡¨æ›´æ–°
Subject.prototype.notify = function (context) {
  var count = this.observers.getCount();
  for (var i = 0; i < count; i++) {
    this.observers.get(i).update(context);
  }
};
```

### Observer(è§‚å¯Ÿè€…)å¯¹è±¡

ä¸»è¦ç”¨äºæä¾›æ›´æ–°æ¥å£

```javascript
function Observer() {
  // æ›´æ–°ç›®æ ‡å®ä¾‹å¯¹è±¡çš„çŠ¶æ€çš„æ¥å£
  this.update = function () {};
}
```

### æ‰©å±•å¯¹è±¡

æ‰©å±•å¯¹è±¡ç”¨äºæ‰©å±•è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡å’Œç›®æ ‡å®ä¾‹å¯¹è±¡

```javascript
// obj -> è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡æˆ–ç›®æ ‡å®ä¾‹å¯¹è±¡
// extension -> éœ€è¦è¢«æ‰©å±•çš„å¯¹è±¡
function extend(obj, extension) {
  for (var key in obj) {
    extension[key] = obj[key];
  }
}
```

### å…·ä½“çš„ DOM å…ƒç´ ç”¨äºåˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡å’Œç›®æ ‡å®ä¾‹å¯¹è±¡

åˆ›å»º DOM å…ƒç´ ï¼Œç”¨äºæ‰©å±•è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡å’Œç›®æ ‡å®ä¾‹å¯¹è±¡

```html
<button id="btn">æ·»åŠ æ–°çš„è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡</button>
<!-- ç›®æ ‡å®ä¾‹å¯¹è±¡ -->
<input type="checkbox" id="checkbox" />
<!-- æ–°åˆ›å»ºçš„è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡çš„å®¹å™¨ -->
<div id="div"></div>
```

åˆ›å»ºç›®æ ‡å®ä¾‹å¯¹è±¡

```javascript
// è·å–checkboxå…ƒç´ 
var checkbox = document.getElementById('checkbox');

// åˆ›å»ºå…·ä½“ç›®æ ‡å®ä¾‹ï¼Œå¹¶ç»‘å®šåˆ°checkboxå…ƒç´ ä¸Š
extend(new Subject(), checkbox);

// ç‚¹å‡»checkboxä¼šè§¦å‘ç›®æ ‡å®ä¾‹å¯¹è±¡çš„é€šçŸ¥æ–¹æ³•
// å¹¿æ’­åˆ°æ‰€æœ‰è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ä¿ƒä½¿å®ƒä»¬è°ƒç”¨æ›´æ–°çŠ¶æ€æ–¹æ³•
checkbox.onclick = function () {
  checkbox.notify(checkbox.checked);
};
```

åˆ›å»ºè§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡

```javascript
// è·å–btnå’Œdivå…ƒç´ 
var btn = document.getElementById('btn'),
  div = document.getElementById('div');

btn.onclick = handlerClick;

function handlerClick() {
  // åˆ›å»ºcheckboxå…ƒç´ (æ³¨æ„å’Œç›®æ ‡å®ä¾‹å¯¹è±¡ä¸åŒ)
  var input = document.createElement('input');
  input.type = 'checkbox';

  // åˆ›å»ºå…·ä½“çš„è§‚å¯Ÿè€…å®ä¾‹ï¼Œå¹¶ç»‘å®šåˆ°checkboxå…ƒç´ ä¸Š
  extend(new Observer(), input);

  // é‡å†™è§‚å¯Ÿè€…æ›´æ–°è¡Œä¸º
  input.update = function (value) {
    this.checked = value;
  };

  // é€šè¿‡ç›®æ ‡å®ä¾‹å¯¹è±¡æ–°å¢éœ€è¦è¢«å¹¿æ’­çš„è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡
  checkbox.add(input);

  // å°†è§‚å¯Ÿè€…é™„åˆ°divå…ƒç´ ä¸Š
  div.appendChild(input);
}
```

> è‡³æ­¤ï¼Œé€šè¿‡æŒ‰é’®æ–°å¢è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ï¼Œç‚¹å‡»ç›®æ ‡ checkbox å®ä¾‹å¯¹è±¡æ—¶ï¼Œcheckbox çš„çŠ¶æ€ä¼šå¹¿æ’­ç»™æ‰€æœ‰æ–°å¢çš„è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ checkboxï¼Œä»è€Œä½¿ç›®æ ‡å®ä¾‹å¯¹è±¡çš„å€¼å’Œè§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡çš„å€¼ä¿æŒä¸€è‡´ï¼Œå®ç°äº†è§‚å¯Ÿè€…æ¨¡å¼ã€‚

## Publish/Subscribe(å‘å¸ƒ/è®¢é˜…)æ¨¡å¼

![å‘å¸ƒ/è®¢é˜…è®¾è®¡æ¨¡å¼](https://raw.githubusercontent.com/ziyi2/js/master/images/pubsub.png)

éœ€è¦æ³¨æ„ token æ˜¯æ¯ä¸€æ¬¡è®¢é˜…çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ token å¯ä»¥å–æ¶ˆç‰¹å®šçš„é¢‘é“è®¢é˜…ã€‚

```javascript
// å‘å¸ƒ/è®¢é˜…æ¨¡å¼
var pubsub = (function () {
  // è®¢é˜…å’Œå‘å¸ƒçš„äº‹ä»¶é¢‘é“é›†ï¼ˆæ¡¥æ¢ã€ä¸­é—´å¸¦ï¼‰
  var _channels = [],
    _subUid = -1;

  return {
    // è®¢é˜…é¢‘é“
    subscribe: function (channel, handler) {
      if (!_channels[channel]) _channels[channel] = [];
      var token = (++_subUid).toString();
      _channels[channel].push({
        token: token,
        handler: handler,
      });
      return token;
    },

    // å¹¿æ’­é¢‘é“
    publish: function (channel, data) {
      if (!_channels[channel]) return false;
      // è·å–é¢‘é“è®¢é˜…è€…
      var subscribers = _channels[channel];
      var len = subscribers.length;
      // åè®¢é˜…å…ˆè§¦å‘
      while (len--) {
        subscribers[len].handler(data, channel, subscribers[len].token);
      }
      return this;
    },

    // ç§»é™¤è®¢é˜…
    unsubscribe: function (token) {
      for (var channel in _channels) {
        var len = _channels[channel].length;
        for (var index = 0; index < len; index++) {
          if (_channels[channel][index].token === token) {
            _channels[channel].splice(index, 1);
            return token;
          }
        }
      }
    },
  };
})();

// è®¢é˜…é¢‘é“0
var token = pubsub.subscribe('channel0', function (data, channel, token) {
  console.log('channel: ' + channel + ' data: ', data + ' token: ' + token);
});

// è®¢é˜…é¢‘é“0
pubsub.subscribe('channel0', function (data, channel, token) {
  console.log('channel: ' + channel + ' data: ', data + ' token: ' + token);
});

// å¹¿æ’­é¢‘é“0
pubsub.publish('channel0', {
  name: 'ziyi2',
  age: 28,
});

// å–æ¶ˆæŸä¸ªç‰¹å®šé¢‘é“0çš„è®¢é˜…
pubsub.unsubscribe(token);

// ç»§ç»­å¹¿æ’­é¢‘é“0
pubsub.publish('channel0', {
  name: 'ziyi2',
  age: 28,
});
```

### Observer(è§‚å¯Ÿè€…)æ¨¡å¼å’Œ Publish/Subscribe(å‘å¸ƒ/è®¢é˜…)æ¨¡å¼çš„åŒºåˆ«

![è§‚å¯Ÿè€…å’Œå‘å¸ƒ/è®¢é˜…æ¨¡å¼å¯¹æ¯”](https://raw.githubusercontent.com/ziyi2/js/master/images/PublishSubscribe.png)

Publish/Subscribe(å‘å¸ƒ/è®¢é˜…)æ¨¡å¼ä½¿ç”¨ä¸€ä¸ªä¸»é¢˜/äº‹ä»¶é€šé“ï¼Œè¿™ä¸ªé€šé“ä»‹äºè®¢é˜…è€…å’Œå‘å¸ƒè€…ä¹‹é—´ï¼Œè¯¥è®¾è®¡æ¨¡å¼å…è®¸ä»£ç å®šä¹‰åº”ç”¨ç¨‹åºçš„ç‰¹å®šäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å¯ä»¥ä¼ é€’è‡ªå®šä¹‰å‚æ•°ï¼Œè‡ªå®šä¹‰å‚æ•°åŒ…å«è®¢é˜…è€…éœ€è¦çš„ä¿¡æ¯ï¼Œé‡‡ç”¨äº‹ä»¶é€šé“å¯ä»¥é¿å…å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¹‹é—´äº§ç”Ÿä¾èµ–å…³ç³»ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒObserver(è§‚å¯Ÿè€…)æ¨¡å¼å…è®¸è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡(è®¢é˜…è€…)æ‰§è¡Œé€‚å½“çš„äº‹ä»¶å¤„ç†ç¨‹åºæ¥æ³¨å†Œå’Œæ¥æ”¶ç›®æ ‡å®ä¾‹å¯¹è±¡(å‘å¸ƒè€…)å‘å‡ºçš„é€šçŸ¥ï¼ˆå³åœ¨è§‚å¯Ÿè€…å®ä¾‹å¯¹è±¡ä¸Šæ³¨å†Œ update æ–¹æ³•ï¼‰ï¼Œä½¿è®¢é˜…è€…å’Œå‘å¸ƒè€…ä¹‹é—´äº§ç”Ÿäº†ä¾èµ–å…³ç³»ï¼Œä¸”æ²¡æœ‰äº‹ä»¶é€šé“ã€‚

### ä¼˜ç‚¹

è§£è€¦ï¼Œå¯ç”¨äºè®¾è®¡åˆ†å±‚ä»¥åŠåˆ†å±‚ä¹‹é—´çš„é€šä¿¡ï¼Œå¯ç”¨äºå°†åº”ç”¨ç¨‹åºåˆ†è§£ä¸ºæ›´å°ã€æ›´æ¾æ•£è€¦åˆçš„å—ï¼Œæ”¹è¿›ä»£ç çš„ç®¡ç†å’Œæ½œåœ¨å¤ç”¨ï¼Œæ˜¯è®¾è®¡è§£è€¦
