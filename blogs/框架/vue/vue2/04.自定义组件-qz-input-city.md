---
title: ç»„ä»¶åº“â€”qz-Input-City
date: 2021-04-24 00:00:00
sidebar: auto
sticky: false
permalink: /pages/vue210424/
categories: 
  - æ¡†æ¶
tags: 
  - vue
---

<p align="center">
  <img width="500" src="https://p15.qhimg.com/dmfd/2560_1440_/t01fdc11ca3eb7831a6.jpg"/>
</p>

> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ğŸŒš
> <!-- more -->

## ç»„ä»¶åº“â€”qz-Input-City

### Attributes

|     å‚æ•°     |        è¯´æ˜        |     ç±»å‹      |           å¯é€‰å€¼           |  é»˜è®¤å€¼  |
| :----------: | :----------------: | :-----------: | :------------------------: | :------: |
|   v-model    |       ç»‘å®šå€¼       |    string     |             â€”â€”             |    â€”â€”    |
|    class     |        ç±»å        |    string     |             â€”â€”             |    â€”â€”    |
| placeholder  |    æ–‡æœ¬æç¤ºè¾“å…¥    |    string     |             â€”â€”             |    â€”â€”    |
|   disabled   |        ç¦ç”¨        |    boolean    |             â€”â€”             |  false   |
|    width     |     æ–‡æœ¬æ¡†å®½åº¦     | string/number |             â€”â€”             |    â€”â€”    |
|    height    |     æ–‡æœ¬æ¡†é«˜åº¦     | string/number |             â€”â€”             |    52    |
|   userCity   |  ä½¿ç”¨å¸¦åŸå¸‚è¾“å…¥æ¡†  |    boolean    |             â€”â€”             |  false   |
| cityNameList |    è¾“å…¥æ¡†çš„æ•°æ®    |    string     |             â€”â€”             | å½“å‰åŸå¸‚ |
|  handClick   |   é€‰æ‹©åŸå¸‚çš„å›è°ƒ   |     event     |             â€”â€”             |    â€”â€”    |
|     slot     | è¾“å…¥æ¡†å¤´éƒ¨å°¾éƒ¨æ’æ§½ |     tags      | beforeContent/afterContent |    â€”â€”    |

### åŸºç¡€ç”¨æ³•

#### 1. è¾“å…¥æ¡†

> `v-model` ä¿®é¥°ç¬¦

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210712112841444.png)

```vue
<qz-InputCity v-model = "city" placeholder="è¯·è¾“å…¥å†…å®¹"></qz-InputCity>
<script>
export default {
  data() {
    return {
      city: ''
    }
  }
}
</script>
```

#### 2. ç¦ç”¨çŠ¶æ€

> é€šè¿‡ `disabled` å±æ€§æŒ‡å®šæ˜¯å¦ç¦ç”¨ input ç»„ä»¶

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210712112901524.png)

```vue
<qz-InputCity 
    v-model = "city" 
    placeholder="è¯·è¾“å…¥å†…å®¹"
    :disabled="disabled">
</qz-InputCity>
<script>
export default {
  data() {
    return {
      city: '',
      disabled: true,
    }
  }
}
</script>

```

#### 3. ä¸åŒå®½åº¦/é«˜åº¦

> ä½¿ç”¨`width`/`height`å±æ€§å³å¯å¾—åˆ°ä¸€ä¸ªè‡ªå®šä¹‰çš„æ–‡æœ¬æ¡†

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/20210712112932114.png)

```vue
<qz-InputCity 
    v-model = "city" 
    placeholder="è¯·è¾“å…¥å†…å®¹"
    width = 400>
</qz-InputCity>
<script>
export default {
  data() {
    return {
      city: ''
    }
  }
}
</script>
```

#### 4. å¤åˆå‹è¾“å…¥æ¡†

> å¯å‰ç½®æˆ–åç½®å…ƒç´ ï¼Œä¸€èˆ¬ä¸ºæ ‡ç­¾æˆ–æ–‡æœ¬

![](https://i.postimg.cc/MHPbRXL9/1649312302-1.png)

```vue
<qz-InputCity
    v-model = "city" 
    placeholder="è¯·è¾“å…¥åŸå¸‚"
    width = 400>
    <div slot ="beforeContent"><svg-icon icon-class="site" class-name="custom-site" /></div>
    <div slot ="afterContent"><svg-icon icon-class="down" class-name="down-site" /></div>
</qz-InputCity>
<script>
export default {
  data() {
    return {
      city: ''
    }
  }
}
</script>
```

### æ ·å¼ç¯‡

> åˆ©ç”¨ ::v-deep æ ·å¼ç©¿é€è¦†ç›–

```css
::v-deep .inputBox {
	border-radius: 26px;
    &:focus-within {
        border: 1px solid #ff6700;
    }
}
```

### codeï¼ˆæºç å®ç°ï¼‰

```vue
<template>
  <div class="inputBox" :style="inputBoxStyle">
    <!-- å‰éƒ¨æ’æ§½ -->
    <div class="beforeContent" v-if="beforeContent">
      <slot name="beforeContent"></slot>
    </div>
    <div class="inputContent" :style="inputContentStyle">
      <input
        readonly
        :placeholder="$attrs.placeholder"
        ref="inputRef"
        :style="inputStyle"
        :disabled="disabled"
        :maxlength="$attrs.maxlength !== '' ? $attrs.maxlength : ''"
        :minlength="$attrs.minlength !== '' ? $attrs.minlength : ''"
        v-model="currentValue"
        @input="setText($event)"
        @click="showList"
      />
      <!-- æ¸…ç©ºæ–‡æœ¬æŒ‰é’® -->
      <div class="reset-box" v-if="$attrs.clearable == ''" @click="clearText">
        <van-icon name="close" class="reset" />
      </div>
    </div>
    <!-- å‰éƒ¨æ’æ§½ -->
    <div class="afterContent" v-if="afterContent">
      <slot name="afterContent"></slot>
    </div>
    <!-- åŸå¸‚é€‰æ‹©æ¡† -->
    <van-popup v-model="showPicker" round position="bottom" :lazy-render='false'>
      <van-picker
        show-toolbar
        :columns="cityList"
        :loading="cityLoading"
        value-key="name"
        @cancel="showPicker = false"
        @confirm="onConfirm"
        ref="vanPicker"
      />
    </van-popup>
  </div>
</template>

<script>
import { getCity } from '@api/allOrder'
import { Toast } from 'vant'
export default {
  name: 'qz-InputCity',
  props: {
    value: {
      // åŒå‘ç»‘å®šä¼ å‚
      type: String,
      default: ''
    },
    disabled: {
      // ç¦ç”¨ä¼ å‚
      type: Boolean,
      default: false
    },
    cityNameList: {
      // æœç´¢åˆ—è¡¨ä¼ å‚
      type: Array,
      default: function () {
        return []
      }
    }
  },
  data () {
    return {
      showPicker: false, // åŸå¸‚éƒ¨åˆ†
      cityList: [],
      cityLoading: false,
      locationCity: [],
      locationCode: []
    }
  },
  computed: {
    inputBoxStyle () {
      var returnStyle = ''
      if (this.disabled) {
        returnStyle +=
          'background-color: #f5f7fa;border-color: #e4e7ed;color: #c0c4cc;cursor: not-allowed;'
      }
      if (this.$attrs.width > 200) {
        returnStyle += `width:${this.$attrs.width}px;`
      } else if (this.$attrs.width > 0 && this.$attrs.width <= 200) {
        Toast('è®¾ç½®å®½åº¦ä¸å¯å°äº200px')
      }
      return returnStyle
    },
    inputContentStyle () {
      var returnStyle = ''
      return returnStyle
    },
    inputStyle () {
      var returnStyle = ''
      if (this.$attrs.height) {
        returnStyle += `height:${this.$attrs.height}px;`
      }
      return returnStyle
    },
    beforeContent () {
      // å¤´éƒ¨slot
      if (this.$slots.beforeContent?.[0]?.children) {
        return true
      }
      return false
    },
    afterContent () {
      // å°¾éƒ¨slot
      if (this.$slots.afterContent?.[0]?.children) {
        return true
      }
      return false
    },
    currentValue () {
      return this.value
    }
  },
  created () {
    this.getCity()
  },
  methods: {
    async getCity () {
      this.cityLoading = true
      const cityObj = JSON.parse(localStorage.getItem('cityObj'))
      if (cityObj) {
        this.initCityData(cityObj)
      } else {
        const res = await getCity()
        localStorage.setItem('cityObj', JSON.stringify(res.data))
        this.initCityData(res.data)
      }
    },
    initCityData (res) {
      this.cityLoading = false
      let arr = []
      Object.keys(res).forEach(function (key) {
        arr = [...arr, res[key]]
      })
      arr.forEach((item, index) => {
        item.children = item.child
        delete item.child
        item.children.forEach((it, i) => {
          it.children = it.child
          delete it.child
        })
      })
      this.cityList = arr
    },
    setText (e) {
      this.$emit('input', e.target.value)
    },
    clearText () {
      this.$refs.inputRef.value = ''
      this.$emit('input', '')
    },
    showList () {
      if (this.$attrs.userCity || this.$attrs.userCity === '') {
        this.showPicker = true
        this.$refs.vanPicker.setColumnValue(0, this.cityNameList[0])
        this.$refs.vanPicker.setColumnValue(1, this.cityNameList[1])
        this.$refs.vanPicker.setColumnValue(2, this.cityNameList[2])
      }
    },
    onConfirm (item, index) {
      const arr = this.cityList
      const code = [arr[index[0]]?.id, arr[index[0]]?.children[index[1]]?.id, arr[index[0]]?.children[index[1]]?.children[index[2]]?.id]
      this.$emit('cityClick', item, code)
      this.showPicker = false
    }
  }
}
</script>

<style lang="scss" scoped>
.inputBox {
  position: relative;
  width: 100%;
  background: #fff;
  display: flex;
  align-items: center;
  box-sizing: border-box;
  border-radius: 5px;
  border: 1px solid #dcdfe6;
  margin: 20px 0px;
  &:focus-within{
    border: 1px solid #409eff;
  }
  input {
    width: 100%;
    height: 52px;
    border-radius: 40px;
    box-sizing: border-box;
    outline: none;
    padding: 5px 100px 5px 20px;
    cursor: pointer;
  }
  .reset-box {
    position: absolute;
    top: 0px;
    right: 16px;
    width: 20px;
    height: 100%;
    box-sizing: border-box;
    padding-top: 4px;
    display: flex;
    align-items: center;
  }
  .reset {
    color: #dcdfe6;
  }
  .reset:hover {
    color: rgb(129, 128, 128);
    cursor: pointer;
  }
  .beforeContent,
  .afterContent {
    padding: 0 20px;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    white-space: nowrap;
  }
  .beforeContent {
    padding-right: 10px;
  }
  .afterContent {
    padding-left: 10px;
  }
  .inputContent {
    position: relative;
    width: 100%;
  }
}
</style>
```

