---
title: ç»„ä»¶åº“â€”qz-Form
date: 2021-04-25 00:00:00
sidebar: auto
sticky: false
permalink: /pages/vue210425/
categories: 
  - æ¡†æ¶
tags: 
  - vue
---

<p align="center">
  <img width="500" src="https://p17.qhimg.com/dmfd/2560_1440_/t01052dfda7f2cade9d.jpg"/>
</p>

> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ğŸŒš
> <!-- more -->

## ç»„ä»¶åº“â€”qz-Form

### Attributes

|    å‚æ•°     |     è¯´æ˜     |  ç±»å‹  | å¯é€‰å€¼ | é»˜è®¤å€¼ |
| :---------: | :----------: | :----: | :----: | :----: |
|  formData   | è¡¨å•æ•°æ®å¡«å…… | object |   â€”â€”   |   {}   |
| getFormData | è¡¨å•æ•°æ®å›è°ƒ | event  |   â€”â€”   |   â€”â€”   |

### åŸºç¡€ç”¨æ³•

![](//staticqn.qizuang.com/custom/20220409/FtwpGoi_hEreX4_QH5tA4tvMkQTW.png)

```
<qz-Form :formData='formData' @getFormData="getFormData" />
export default {
  name: 'order',
  components: {},
  data () {
    return {
      // è¡¨å•
      formData: {}
    }
  },
  methods: {
    getFormData (val) {
      console.log(val)
    }
  }
}
```

#### 1. formData

```javascript
{
	formItem: [],
	formCheck: {},
	formButton: {},
	options: {},
	isValidate: false
}
```

- formItem

  > åŸºæœ¬é¡¹

  |     å‚æ•°     |       è¯´æ˜       |     ç±»å‹      |                å¯é€‰å€¼                 | é»˜è®¤å€¼ |
  | :----------: | :--------------: | :-----------: | :-----------------------------------: | :----: |
  |     name     |     æäº¤æ•°æ®     |    string     | city/mianji/name/xiaoqu/tel/send_code |   â€”â€”   |
  |    class     |       ç±»å       |    string     |                  â€”â€”                   |   â€”â€”   |
  |  showLength  | æ˜¯å¦æ˜¾ç¤ºé•¿åº¦é™åˆ¶ |    boolean    |                  â€”â€”                   | false  |
  |  maxlength   |   æœ€å¤§è¾“å…¥é•¿åº¦   | string/number |                  â€”â€”                   |   â€”â€”   |
  |  minlength   |   æœ€å°è¾“å…¥é•¿åº¦   | string/number |                  â€”â€”                   |   â€”â€”   |
  | placeholder  |   æ–‡æœ¬æç¤ºè¾“å…¥   |    string     |                  â€”â€”                   |   â€”â€”   |
  |  clearable   |    æ˜¯å¦å¯æ¸…ç©º    |    boolean    |                  â€”â€”                   | false  |
  | showPassword | åˆ‡æ¢ä¸ºå¯†ç æ–‡æœ¬æ¡† |    boolean    |                  â€”â€”                   | false  |
  |   disabled   |       ç¦ç”¨       |    boolean    |                  â€”â€”                   | false  |
  |    width     |    æ–‡æœ¬æ¡†å®½åº¦    | string/number |                  â€”â€”                   |   â€”â€”   |
  |    height    |    æ–‡æœ¬æ¡†é«˜åº¦    | string/number |                  â€”â€”                   |   52   |

  > å‰åæ’æ§½é¡¹

  |        å‚æ•°         | å¯é€‰å€¼ |           è¯´æ˜            |  ç±»å‹   | å¯é€‰å€¼ |                        å‚è€ƒ                         |
  | :-----------------: | :----: | :-----------------------: | :-----: | :----: | :-------------------------------------------------: |
  |                     |  icon  |           å›¾æ ‡            | string  |   â€”â€”   | ![](https://i.postimg.cc/W4XbpnbH/1649491102-1.png) |
  | slot[beforeContent] | string |    æ–‡å­—ï¼ˆæ— ç›¸å…³æ“ä½œï¼‰     | string  |   â€”â€”   | ![](https://i.postimg.cc/DyWY6dJ3/1649491319-1.png) |
  |                     |  code  | æ–‡å­—ï¼ˆæœ‰ç›¸å…³æ“ä½œ-éªŒè¯ç ï¼‰ | boolean |   â€”â€”   | ![](https://i.postimg.cc/J0yVbwV9/1649491388-1.png) |
  |                     |  icon  |           å›¾æ ‡            | string  |   â€”â€”   |                         â€”â€”                          |
  | slot[afterContent]  | string |    æ–‡å­—ï¼ˆæ— ç›¸å…³æ“ä½œï¼‰     | string  |   â€”â€”   |                         â€”â€”                          |
  |                     |  code  | æ–‡å­—ï¼ˆæœ‰ç›¸å…³æ“ä½œ-éªŒè¯ç ï¼‰ | boolean |   â€”â€”   |                         â€”â€”                          |

- formCheck

  |   å‚æ•°    |     è¯´æ˜     |     ç±»å‹      |    å¯é€‰å€¼    |  é»˜è®¤å€¼  |
  | :-------: | :----------: | :-----------: | :----------: | :------: |
  |  checked  | åˆå§‹å‹¾é€‰çŠ¶æ€ |    boolean    |      â€”â€”      |  false   |
  |   class   |     ç±»å     |    string     |      â€”â€”      |    â€”â€”    |
  |   shape   |     å½¢çŠ¶     |    string     | round/square |  round   |
  |   size    |     å¤§å°     | string/number |      â€”â€”      |    â€”â€”    |
  |   color   | é€‰ä¸­çŠ¶æ€é¢œè‰² |    string     |      â€”â€”      | \#1989fa |
  | agreement |     å£°æ˜     |    object     |      â€”â€”      |    â€”â€”    |

  - agreementå‚æ•°ä¸ºè¦†ç›–æ“ä½œ

    ```javascript
    agreement: [
        {
            name: 'ã€Šè‡ªå®šä¹‰å£°æ˜ã€‹',   // åç§°
            path: 'disclaimer'     // è·¯å¾„
        }
    ]
    ```

- formButton

  | å‚æ•°  |   è¯´æ˜   |  ç±»å‹  | å¯é€‰å€¼ | é»˜è®¤å€¼ |
  | :---: | :------: | :----: | :----: | :----: |
  | text  | æŒ‰é’®åç§° | string |   â€”â€”   |   â€”â€”   |
  | class |   ç±»å   | string |   â€”â€”   |   â€”â€”   |

- options

  |  å‚æ•°  | è¯´æ˜ |  ç±»å‹  | å¯é€‰å€¼ | é»˜è®¤å€¼ |
  | :----: | :--: | :----: | :----: | :----: |
  | source | æ ‡è¯† | string |   â€”â€”   |   â€”â€”   |
  |  src   | SRC  | string |   â€”â€”   |   â€”â€”   |

- isValidate

  |          è¯´æ˜          |  ç±»å‹   | å¯é€‰å€¼ | é»˜è®¤å€¼ |
  | :--------------------: | :-----: | :----: | :----: |
  | æ˜¯å¦å¯¹è¡¨å•è¿›è¡Œç›¸å…³æ ¡éªŒ | boolean |   â€”â€”   | false  |

#### 2. getFormData

- éœ€æ ¡éªŒ

  ```
  {
      "form": {
          "mianji": "120",
          "name": "å°ç‹",
          "xiaoqu": "ä¹”å®¶å¤§é™¢",
          "tel": "15288888888",
          "send_code": "123321",
          "cs": 320500,
          "qx": 320508,
          "source": "20220407",
          "src": "zxx-h5"
      },
      "options": {
          "source": "20220407",
          "src": "zxx-h5"
      }
  }
  ```

- ä¸éœ€æ ¡éªŒ

  ```
  {
      "form": {
          "mianji": "120",
          "name": "å°ç‹",
          "xiaoqu": "ç‹å®¶å¤§é™¢",
          "tel": "15266666666",
          "send_code": "123321",
          "cs": 320500,
          "qx": 320508,
          "source": "20220407",
          "src": "zxx-h5"
      },
      "options": {
          "source": "20220407",
          "src": "zxx-h5"
      },
      "check": true
  }
  ```

### æ ·å¼ç¯‡

> åˆ©ç”¨ ::v-deep æ ·å¼ç©¿é€è¦†ç›–

```css
::v-deep #qz-form {
    .order-input {
        border-radius: 26px;
        &:focus-within {
            border: 1px solid #ff6700;
        }
    }
}
```

### codeï¼ˆå®ç°ï¼‰

```vue
<template>
  <div class="order-container">
    <div class="header"></div>
    <div class="content">
      <div class="order-head">
        <img
          src="//staticqn.qizuang.com/custom/20210811/FnUQFcV2Qxq36QeW1gYUqefB9kVo.png"
          alt=""
        />
      </div>
      <qz-Form :formData='orderInfo' @getFormData="getFormData" />
    </div>
    <div class="footer">
      <div class="title">ä¸šä¸»æ¡ˆä¾‹æ›´çœŸå®</div>
      <img
        src="//staticqn.qizuang.com/custom/20210817/FhLuVuXoe9D_MKPPNmvNuFaDMVV0.png"
      />
    </div>
  </div>
</template>
<script>
export default {
  name: 'order',
  components: {},
  data () {
    return {
      // è¡¨å•
      orderInfo: {
        formItem: [
          {
            name: 'city',
            class: 'order-input',
            height: 40,
            slot: {
              beforeContent: { icon: 'site' },
              afterContent: { icon: 'down' }
            }
          },
          {
            name: 'mianji',
            class: 'order-input',
            showLength: true,
            maxlength: 6,
            placeholder: 'è¾“å…¥æ‚¨çš„æˆ¿å±‹é¢ç§¯',
            clearable: true,
            height: 40,
            slot: {
              beforeContent: { icon: 'code' },
              afterContent: { string: 'ã¡' }
            }
          },
          {
            name: 'name',
            class: 'order-input',
            showLength: true,
            maxlength: 10,
            placeholder: 'è¾“å…¥æ‚¨çš„å§“å',
            clearable: true,
            height: 40,
            slot: {
              beforeContent: { icon: 'user' }
            }
          },
          {
            name: 'xiaoqu',
            class: 'order-input',
            placeholder: 'è¯·å¡«å†™æ‚¨çš„å°åŒºä»¥ä¾¿ç²¾å‡†åŒ¹é…',
            clearable: true,
            height: 40,
            slot: {
              beforeContent: { icon: 'house' }
            }
          },
          {
            name: 'tel',
            class: 'order-input',
            placeholder: 'å·ç å·²åŠ å¯†ï¼ŒæŠ¥ä»·ä¿¡æ¯ä»¥çŸ­ä¿¡å‘é€',
            maxlength: '11',
            clearable: true,
            height: 40,
            slot: {
              beforeContent: { icon: 'phone' }
            }
          },
          {
            name: 'send_code',
            class: 'order-input',
            placeholder: 'è¾“å…¥éªŒè¯ç ',
            maxlength: '6',
            clearable: true,
            height: 40,
            slot: {
              beforeContent: { icon: 'code' },
              afterContent: { code: true }
            }
          }
        ],
        formCheck: {
          checked: false,
          class: 'form-check',
          shape: 'round',
          size: '16',
          color: '#ff6700',
          agreement: [
            {
              name: 'ã€Šè‡ªå®šä¹‰å£°æ˜ã€‹',
              path: 'disclaimer'
            }
          ]
        },
        formButton: {
          text: 'ç«‹å³è®¡ç®—æŠ¥ä»·',
          class: 'sub'
        },
        options: {
          source: '20220407',
          src: 'zxx-h5'
        },
        isValidate: true
      }
    }
  },
  created () {},
  methods: {
    getFormData (val) {
      console.log(val)
    }
  }
}
</script>
<style lang="scss" scoped>
.order-container {
  background-color: #f9f7f6;
  img {
    width: 100%;
  }
  .header {
    width: 100%;
    height: 850px;
    background: url(//staticqn.qizuang.com/custom/20210817/FqdjsZHzTSieYcCtfQIIVbBGttPd.png)
      no-repeat center;
    background-size: 100% 100%;
  }
  .footer {
    .title {
      font-size: 36px;
      font-weight: bold;
      line-height: 120px;
      text-align: center;
    }
  }
  .content {
    background: #faf8f7;
    overflow: hidden;
    box-sizing: border-box;
    margin: -180px auto 0;
    padding: 0 20px;
    width: 92%;
    border-radius: 10px;
    box-shadow: 0px 0px 20px #d6d5d5;
    overflow: hidden;
    ::v-deep #qz-form {
      .order-input {
        border-radius: 26px;
        &:focus-within {
          border: 1px solid #ff6700;
        }
      }
    }
  }
}
</style>
```

### codeï¼ˆæºç å®ç°ï¼‰

```vue
<template>
  <div id="qz-form">
    <div v-for="(item, key) in orderInfo.formItem" :key="key">
      <template v-if="item.name === 'city'">
        <qz-InputCity
          :class="item.class"
          v-model="city"
          :placeholder="item.placeholder"
          :height="item.height"
          :width="item.width"
          :clearable="item.clearable"
          :disabled="item.disabled"
          userCity
          :cityNameList="cityData"
          @cityClick="cityClick"
        >
            <div slot="beforeContent" v-if="item.slot.beforeContent">
            <template v-if="item.slot.beforeContent.icon">
              <svg-icon
                :icon-class="item.slot.beforeContent.icon"
                :class-name="`custom-${item.slot.beforeContent.icon}`"
              />
            </template>
            <template v-if="item.slot.beforeContent.string">
              <span v-html="item.slot.beforeContent.string"></span>
            </template>
          </div>
          <div slot="afterContent" v-if="item.slot.afterContent">
            <template v-if="item.slot.afterContent.icon">
              <svg-icon
                :icon-class="item.slot.afterContent.icon"
                :class-name="`custom-${item.slot.afterContent.icon}`"
              />
            </template>
            <template v-if="item.slot.afterContent.string">
              <span v-html="item.slot.afterContent.string"></span>
            </template>
          </div>
        </qz-InputCity>
      </template>
      <template v-if="item.name !== 'city'">
        <qz-Input
          :class="item.class"
          v-model.trim="item.value"
          :showLength="item.showLength"
          :maxlength="item.maxlength"
          :minlength="item.minlength"
          :placeholder="item.placeholder"
          :clearable="item.clearable"
          :showPassword="item.showPassword"
          :disabled="item.disabled"
          :height="item.height"
          :width="item.width"
        >
          <div slot="beforeContent" v-if="item.slot.beforeContent">
            <template v-if="item.slot.beforeContent.icon">
              <svg-icon
                :icon-class="item.slot.beforeContent.icon"
                :class-name="`custom-${item.slot.beforeContent.icon}`"
              />
            </template>
            <template v-if="item.slot.beforeContent.string">
              <span v-html="item.slot.beforeContent.string"></span>
            </template>
            <template v-if="item.slot.beforeContent.code">
              <span v-show="code.show" @click="getCode" class="getCode"
                >è·å–éªŒè¯ç </span
              >
              <span v-show="!code.show" class="count"
                >{{ code.count }}såé‡æ–°è·å–</span
              >
            </template>
          </div>
          <div slot="afterContent" v-if="item.slot.afterContent">
            <template v-if="item.slot.afterContent.icon">
              <svg-icon
                :icon-class="item.slot.afterContent.icon"
                :class-name="`custom-${item.slot.afterContent.icon}`"
              />
            </template>
            <template v-if="item.slot.afterContent.string">
              <span v-html="item.slot.afterContent.string"></span>
            </template>
            <template v-if="item.slot.afterContent.code">
              <span v-show="code.show" @click="getCode" class="getCode"
                >è·å–éªŒè¯ç </span
              >
              <span v-show="!code.show" class="count"
                >{{ code.count }}såé‡æ–°è·å–</span
              >
            </template>
          </div>
        </qz-Input>
      </template>
    </div>
    <div :class="orderInfo.formCheck.class" class="form-check">
      <van-checkbox v-model="orderInfo.formCheck.checked" label-disabled :shape="orderInfo.formCheck.shape" :icon-size="orderInfo.formCheck.size" :checked-color="orderInfo.formCheck.color">
        æˆ‘å·²é˜…è¯»å¹¶åŒæ„
      </van-checkbox>
      <template v-if="orderInfo.formCheck.agreement">
          <router-link v-for="(item, key) in orderInfo.formCheck.agreement" :key="key" :to="item.path">
          {{item.name}}
          </router-link>
        </template>
        <template v-else>
          <router-link to="/disclaimer">ã€Šå…è´£å£°æ˜ã€‹</router-link>
        </template>
    </div>
    <button
      :class="orderInfo.formButton.class"
      class="order-submit"
      @click="onSubmit"
    >
      {{ orderInfo.formButton.text }}
    </button>
  </div>
</template>

<script>
import { mapLocation, sendMessage } from '@api/allOrder'
import { Toast } from 'vant'
import { validate } from '@/utils/reg'
export default {
  name: 'qz-Form',
  components: {},
  props: {
    formData: {
      type: Object,
      required: true
    }
  },
  data () {
    return {
      // åŸå¸‚
      city: '',
      cityData: [],
      cityCode: [],
      // éªŒè¯ç 
      code: {
        show: true,
        count: '',
        timer: null
      },
      // è¡¨å•
      orderInfo: {}
    }
  },
  watch: {
    formData: {
      handler (val) {
        this.orderInfo = val
      },
      immediate: true,
      deep: true
    }
  },
  created () {
    this.mapLocation()
  },
  methods: {
    async mapLocation () {
      const res = await mapLocation()
      if (res.error_code === '0') {
        this.cityData = [
          res.data.provice_name,
          res.data.city_name,
          res.data.area_name
        ]
        this.cityCode = [
          res.data.province_id,
          res.data.city_id,
          res.data.area_id
        ]
        this.city = this.cityData.join(' ')
      } else {
        Toast('å®šä½è·å–å¤±è´¥ï¼')
        this.cityData = ['æ±Ÿè‹çœ', 'è‹å·', 'å·¥ä¸šå›­åŒº']
        this.cityCode = [320000, 320500, 320508]
        this.city = this.cityData.join(' ')
      }
    },
    cityClick (val, code) {
      this.city = val.join(' ')
      this.cityData = val
      this.cityCode = code
    },
    async getCode () {
      const TIME_COUNT = 60
      const code = this.code
      const tel = this.orderInfo.formItem.find((item) => {
        return item.name === 'tel'
      })
      if (!validate.tel(tel.value)) return false
      const res = await sendMessage({ phone: tel.value, type: 2 })
      if (!code.timer && res.error_code === 0) {
        code.count = TIME_COUNT
        code.show = false
        code.timer = setInterval(() => {
          if (code.count > 0 && code.count <= TIME_COUNT) {
            code.count--
          } else {
            code.show = true
            clearInterval(code.timer)
            code.timer = null
          }
        }, 1000)
      }
    },
    onSubmit () {
      const obj = {}
      this.orderInfo.formItem.map((item) => {
        obj[item.name] = item.value
      })
      delete obj.city
      const check = this.orderInfo.formCheck.checked
      const options = this.orderInfo.options
      const form = {
        ...obj,
        cs: this.cityCode[1],
        qx: this.cityCode[2],
        ...options
      }
      const isValidate = this.orderInfo.isValidate
      if (!isValidate) {
        const isReady = this.validateFormItem(obj, check)
        isReady && this.$emit('getFormData', { form, options })
      } else {
        this.$emit('getFormData', { form, options, check })
      }
    },
    validateFormItem (obj, check) {
      const checkArr = Object.keys(obj).map((value) => ({
        name: value,
        value: obj[value]
      }))
      const bool = checkArr.every((item, index) => {
        if (validate[`${item.name}`] === undefined) {
          return true
        } else {
          return validate[`${item.name}`](item.value) === true
        }
      })
      bool && !check && Toast({ message: 'è¯·å‹¾é€‰æˆ‘å·²é˜…è¯»å¹¶åŒæ„é½è£…ç½‘çš„å£°æ˜åŠåè®®' })
      return bool && check
    }
  }
}
</script>
<style lang="scss" scoped>
#qz-form {
  padding-bottom: 20px;
  .form-check{
    display: flex;
    align-items: center;
    flex-wrap: wrap;
  }
  .order-submit {
    border: 0;
    outline: none;
    text-align: center;
    margin: 0 auto;
    display: block;
    border: 1px solid #dcdfe6;
    height: 80px;
    width: 80%;
    background: #ffffff;
    padding: 0 20px;
    border-radius: 30px;
  }
}
</style>
```

