---
title: vue3å¾€æœŸå›é¡¾
date: 2022-04-07 00:00:00
sidebar: auto
sticky: false
permalink: /pages/vue220407/
categories: 
  - æ¡†æ¶
tags: 
  - vue

---

<p align="center">
  <img width="500" src="https://p18.qhimg.com/bdr/__85/d/_open360/20140924wzk/746.jpg"/>
</p>


> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ğŸ’•
> <!-- more -->

## Vue3å¾€æœŸå›å½’

### Vue3

- ç®€ä»‹

  2020å¹´9æœˆ18æ—¥å‘å¸ƒ

- å¸¦æ¥äº†ä»€ä¹ˆ

  - æ€§èƒ½çš„æå‡
  - æºç å‡çº§
    - ä½¿ç”¨Proxyä»£æ›¿DefinePropertyå®ç°å“åº”å¼
    - é‡å†™è™šæ‹ŸDOMçš„å®ç°å’ŒTree-Shaking
    - ...

- æ‹¥æŠ±TypeScript

- æ–°çš„ç‰¹æ€§

  - ç»„åˆå¼API
    - setupé…ç½®
    - refä¸reactive
    - watchä¸watchEffect
    - provideä¸inject
    - ...
  - å†…ç½®ç»„ä»¶
    - Fragment
    - Teleport
    - Suspense
  - å…¶ä»–
    - æ–°çš„ç”Ÿå‘½å‘¨æœŸ
    - dataé€‰é¡¹åº”å§‹ç»ˆè¢«å£°æ˜ä¸ºä¸€ä¸ªå‡½æ•°
    - ç§»é™¤keyCode
    - ...

### Vue3å·¥ç¨‹

- ä½¿ç”¨vue-cli åˆ›å»º

- ä½¿ç”¨viteåˆ›å»º

  - æ¦‚å¿µ

    æ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·

  - ä¼˜åŠ¿

    å¼€å‘ç¯å¢ƒï¼Œæ— éœ€æ‰“åŒ…æ“ä½œï¼Œå¿«é€Ÿå†·å¯åŠ¨

    è½»é‡å¿«é€Ÿçƒ­é‡è½½

    æŒ‰éœ€ç¼–è¯‘ï¼Œä¸ç”¨ç­‰å¾…æ•´ä¸ªåº”ç”¨ç¼–è¯‘å®Œæˆ

- å·¥ç¨‹ç»“æ„

  - main.js

    ```vue
    // vue2
    import Vue from 'vue'
    import App from './App.vue'
    new Vue({
    	render: h => h(App)
    }).$mount('#app')
    
    // vue3
    import { createApp } from 'vue'
    import App from './App.vue'
    createApp(App).mount('#app')
    ```

  - components
  
    å¯ä»¥æ²¡æœ‰`æ ¹æ ‡ç­¾`

## ä¸€ã€å¸¸ç”¨Composition API

- setup
  - ç†è§£ï¼š å€¼ä¸ºä¸€ä¸ªå‡½æ•°

  - setupæ˜¯æ‰€æœ‰Composition API "è¡¨æ¼”çš„èˆå°"

  - ç»„ä»¶ä¸­æ‰€ç”¨åˆ°çš„ï¼š æ•°æ®ï¼Œæ–¹æ³•ç­‰ï¼Œå‡è¦é…ç½®åœ¨setupä¸­

  - ä¸¤ç§è¿”å›å€¼

    - è‹¥è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯¹è±¡ä¸­å±æ€§ï¼Œæ–¹æ³•ï¼Œæ¨¡æ¿ä¸­å‡å¯ä»¥ç›´æ¥ä½¿ç”¨
    - è‹¥è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œåˆ™å¯è‡ªå®šä¹‰æ¸²æŸ“å†…å®¹

  - æ³¨æ„ç‚¹

    - å°½é‡ä¸è¦ä¸Vue2.xé…ç½®æ··ç”¨

      1. Vue2.xé…ç½®ï¼ˆdata, methods, computed,....ï¼‰å¯ä»¥è®¿é—®åˆ°setupä¸­çš„å±æ€§ï¼Œæ–¹æ³•
      2. ä½†æ˜¯setupä¸­ä¸èƒ½è®¿é—®åˆ°Vue2.xé…ç½®ï¼ˆdata,methods,computedï¼‰
      3. å¦‚æœæœ‰é‡åï¼Œsetupä¼˜å…ˆ

    - setupä¸èƒ½æ˜¯ä¸ªasyncå‡½æ•°ï¼Œå› ä¸ºè¿”å›å€¼ä¸å†æ˜¯returnçš„å¯¹è±¡ï¼Œè€Œæ˜¯promiseï¼Œæ¨¡æ¿çœ‹ä¸åˆ°returnå¯¹è±¡ä¸­çš„å±æ€§ã€‚

      ï¼ˆåæœŸä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ªPromiseå®ä¾‹ï¼Œä½†éœ€è¦Suspenseå’Œå¼‚æ­¥ç»„ä»¶çš„é…åˆï¼‰

- refå‡½æ•°

  - ä½œç”¨ï¼š å®šä¹‰ä¸€ä¸ªå“åº”å¼çš„æ•°æ®

  - è¯­æ³•

    ```
    const xxx = ref(initValue)
    ```

    - åˆ›å»ºä¸€ä¸ªåŒ…å«å“åº”å¼æ•°æ®çš„å¼•ç”¨å¯¹è±¡ï¼ˆreferenceå¯¹è±¡ï¼Œç®€ç§°refå¯¹è±¡ï¼‰
    - JSæ“ä½œæ•°æ®ï¼š xxx.value
    - æ¨¡æ¿ä¸­è¯»å–æ•°æ®ï¼Œä¸éœ€è¦.value,ç›´æ¥ï¼š`<div>{{xxx}}</div>`

  - å¤‡æ³¨

    - æ¥å—çš„æ•°æ®å¯ä»¥æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡ç±»å‹
    - åŸºæœ¬æ•°æ®ç±»å‹ï¼š å“åº”å¼ä¾ç„¶æ˜¯é Object.defineProperty()çš„setä¸getå®Œæˆçš„
    - å¯¹è±¡ç±»å‹çš„æ•°æ®ï¼š å†…éƒ¨æ±‚åŠ©äº† Vue3.0ä¸­çš„ä¸€ä¸ªæ–°å‡½æ•°â€”â€”reactiveå‡½æ•°

  ```vue
  // ç¤ºä¾‹ï¼Œæ‰§è¡ŒchangeInfoå‡½æ•°ä¿®æ”¹ä¿¡æ¯ï¼Œå“åº”å¼æ•°æ®
  import {ref} from 'vue'
  export default {
  	name: 'App',
    	setup(){
      	let name = ref('LHD')
      	let age = ref(19)
      	let job = ref({
      	  type:'å‰ç«¯CVå·¥ç¨‹å¸ˆ',
      	  salary:'15k'
      	})
      	function changeInfo(){
      	  name.value = 'DHL',
      	  age.value = '20',
      	  job.value.type = 'æ¬ç –å·¥ç¨‹å¸ˆ',
      	  job.value.salary = '10k'
      	}
      	return{
      	  name,
      	  age,
      	  job,
      	  changeInfo
      	}
  	}
  }
  ```

- reactiveå‡½æ•°

  - ä½œç”¨ï¼š å®šä¹‰ä¸€ä¸ªå¯¹è±¡ç±»å‹çš„å“åº”å¼æ•°æ®
  - è¯­æ³•ï¼šconst ä»£ç†å¯¹è±¡ = reactive(æºå¯¹è±¡)
  - reactiveå®šä¹‰çš„å“åº”å¼æ•°æ®æ˜¯æ·±å±‚æ¬¡çš„
  - å†…éƒ¨åŸºäºES6çš„Proxyå®ç°ï¼Œé€šè¿‡ä»£ç†å¯¹è±¡æ“ä½œæºå¯¹è±¡å†…éƒ¨æ•°æ®è¿›è¡Œæ“ä½œ

  ```vue
  // å…ˆå¼•å…¥reactive
  import {reactive} from 'vue'
  // 2çš„ç¤ºä¾‹ï¼Œsetupå‡½æ•°ä¸­æ”¹æˆè¿™æ ·
  let person = reactive({
  	name:'LHD',
    	age:'19',
    	job:{
      	type:'å·¥ç¨‹å¸ˆ',
      	salary:'20k'
    	},
    	hobby:['Study','Video Game']
  })
  function changeInfo(){
  	person.name = 'DHL',
    	person.age = '20',
    	person.job.type = 'æ¬ç –å·¥ç¨‹å¸ˆ',
    	person.job.salary = '10k',
    	person.hobby[1] = 'fly'
  }
  return{
  	person,
    	changeInfo
  }
  ```

- Vue3.0ä¸­çš„å“åº”å¼åŸç†

  - vue2.xçš„å“åº”å¼

    - å®ç°åŸç†

      å¯¹è±¡ç±»å‹ï¼š é€šè¿‡Object.defineProperty() å¯¹å±æ€§çš„è¯»å–ï¼Œä¿®æ”¹è¿›è¡Œæ‹¦æˆªï¼ˆæ•°æ®åŠ«æŒï¼‰

      æ•°ç»„ç±»å‹ï¼š é€šè¿‡é‡å†™æ›´æ–°æ•°ç»„çš„ä¸€ç³»åˆ—æ–¹æ³•æ¥å®ç°æ‹¦æˆªã€‚ï¼ˆå¯¹æ•°ç»„çš„å˜æ›´æ–¹æ³•è¿›è¡Œäº†åŒ…è£¹ï¼‰

  - vue3.0çš„å“åº”å¼

    - é€šè¿‡Proxy(ä»£ç†)ï¼š**æ‹¦æˆª**å¯¹è±¡ä¸­ä»»æ„å±æ€§çš„å˜åŒ–ã€‚

      é€šè¿‡Reflect(åå°„)ï¼šå¯¹æºå¯¹è±¡çš„å±æ€§è¿›è¡Œ**æ“ä½œ**

      ```
      new Proxy(data, {
      	// æ‹¦æˆªè¯»å–å±æ€§å€¼
          get (target, prop) {
          	return Reflect.get(target, prop)
          },
          // æ‹¦æˆªè®¾ç½®å±æ€§å€¼æˆ–æ·»åŠ æ–°å±æ€§
          set (target, prop, value) {
          	return Reflect.set(target, prop, value)
          },
          // æ‹¦æˆªåˆ é™¤å±æ€§
          deleteProperty (target, prop) {
          	return Reflect.deleteProperty(target, prop)
          }
      })
      proxy.name = 'tom'   
      ```

- reactiveå¯¹æ¯”ref

  - å®šä¹‰æ•°æ®è§’åº¦å¯¹æ¯”
    - refç”¨æ¥å®šä¹‰ï¼š åŸºæœ¬æ•°æ®ç±»å‹
    - reactiveç”¨æ¥å®šä¹‰ï¼š å¯¹è±¡ï¼ˆæˆ–æ•°ç»„ï¼‰ç±»å‹æ•°æ®
  - åŸç†è§’åº¦å¯¹æ¯”
  - ä½¿ç”¨è§’åº¦
    - refå®šä¹‰çš„æ•°æ®ï¼š æ“ä½œéœ€è¦`.value`

- setupçš„ä¸¤ä¸ªæ³¨æ„ç‚¹

  - æ‰§è¡Œæ—¶æœº

    beforeCreateä¹‹å‰æ‰§è¡Œï¼Œthisä¸ºundefined

  - å‚æ•°

    - props

      å€¼ä¸ºå¯¹è±¡ï¼ŒåŒ…å«ï¼šç»„ä»¶å¤–éƒ¨ä¼ é€’è¿‡æ¥ï¼Œä¸”ç»„ä»¶å†…éƒ¨æ¥å—äº†çš„å±æ€§

    - context: ä¸Šä¸‹æ–‡å¯¹è±¡

      1. attrs: å€¼ä¸ºå¯¹è±¡ï¼Œæœªåœ¨propsé…ç½®ä¸­å£°æ˜çš„å±æ€§ï¼Œç›¸å½“äº`this.$attrs`
      2. slots: æ”¶åˆ°çš„æ’æ§½å†…å®¹ï¼Œç›¸å½“äºthis.$slots
      3. emit: åˆ†å‘è‡ªå®šä¹‰äº‹ä»¶çš„å‡½æ•°ï¼Œç›¸å½“äº`this.$emit`

    [setupçš„ä¸¤ä¸ªæ³¨æ„ç‚¹](https://wekenw.gitee.io/vuedoc/vue3_test/06_src_setup%E7%9A%84%E4%B8%A4%E4%B8%AA%E6%B3%A8%E6%84%8F%E7%82%B9.html#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84)

- è®¡ç®—å±æ€§ä¸ç›‘å¬

  - computedå‡½æ•°

    ```vue
    import {computed} from 'vue'
    setup(){
        ...
    	//è®¡ç®—å±æ€§â€”â€”ç®€å†™
        let fullName = computed(()=>{
            return person.firstName + '-' + person.lastName
        })
        //è®¡ç®—å±æ€§â€”â€”å®Œæ•´
        let fullName = computed({
            get(){
                return person.firstName + '-' + person.lastName
            },
            set(value){
                const nameArr = value.split('-')
                person.firstName = nameArr[0]
                person.lastName = nameArr[1]
            }
        })
    }
    ```

  - watchå‡½æ•°

  - watchEffectå‡½æ•°

- ç”Ÿå‘½å‘¨æœŸ

- è‡ªå®šä¹‰hookå‡½æ•°

- toRef

  - ä½œç”¨ï¼šåˆ›å»ºä¸€ä¸ªrefå¯¹è±¡ï¼Œå…¶valueå€¼æŒ‡å‘å¦ä¸€ä¸ªå¯¹è±¡ä¸­çš„æŸä¸ªå±æ€§

    ```javascript
    <h2>å§“åï¼š{{name}}</h2>
    <h2>å¹´é¾„ï¼š{{age}}</h2>
    setup(){
        //æ•°æ®
        let person = reactive({
            name:'å¼ ä¸‰',
            age:18,
            job:{
                j1:{
                    salary:20
                }
            }
        })
        //è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼ˆå¸¸ç”¨ï¼‰
        return {
            person,
            // name:toRef(person,'name'),
            // age:toRef(person,'age'),
            // salary:toRef(person.job.j1,'salary'),
            ...toRefs(person)
        }
    }
    ```

## äºŒã€å…¶ä»–Composition API

- shallowRectiveä¸shallowRef

  æµ…å“åº”å¼

- readonlyä¸shallowReadonly

  - readonly: æ·±åªè¯»
  - shallowReadonly: æµ…åªè¯»

- toRawä¸markRaw

  - toRaw: å°†å“åº”å¼å¯¹è±¡è½¬ä¸ºæ™®é€šå¯¹è±¡
  - markRaw: æ ‡è®°å¯¹è±¡ï¼Œä½¿å…¶æ°¸è¿œä¸ä¼šæˆä¸ºå“åº”å¼å¯¹è±¡

- customRef

  åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰çš„refï¼Œå¹¶å¯¹å…¶ä¾èµ–é¡¹è·Ÿè¸ªå’Œæ›´æ–°è§¦å‘è¿›è¡Œæ˜¾ç¤ºæ§åˆ¶

- provideä¸inject

  - ä½œç”¨ï¼š å®ç°ç¥–ä¸åä»£ç»„ä»¶é—´é€šä¿¡

- å“åº”å¼æ•°æ®åˆ¤æ–­

  - isRef: æ£€æŸ¥ä¸€ä¸ªå€¼æ˜¯å¦ä¸ºä¸€ä¸ª ref å¯¹è±¡
  - isReactive: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive åˆ›å»ºçš„å“åº”å¼ä»£ç†
  - isReadonly: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± readonly åˆ›å»ºçš„åªè¯»ä»£ç†
  - isProxy: æ£€æŸ¥ä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ç”± reactive æˆ–è€… readonly æ–¹æ³•åˆ›å»ºçš„ä»£ç†

## ä¸‰ã€Composition APIçš„ä¼˜åŠ¿

![img](https://img-blog.csdnimg.cn/547a25467a2c4bc5bb5c2b32f797ae73.gif)

## å››ã€æ–°çš„ç»„ä»¶

- Fragment

  è™šæ‹Ÿæ ¹æ ‡ç­¾

- Teleport

  å°†æˆ‘ä»¬çš„ç»„ä»¶htmlç»“æ„ç§»åŠ¨åˆ°æŒ‡å®šä½ç½®çš„æŠ€æœ¯

- Suspense

  ç­‰å¾…å¼‚æ­¥ç»„ä»¶æ—¶æ¸²æŸ“ä¸€äº›é¢å¤–å†…å®¹ï¼Œè®©åº”ç”¨æœ‰æ›´å¥½çš„ç”¨æˆ·ä½“éªŒ

  [Suspense](https://wekenw.gitee.io/vuedoc/vue3_test/21_src_Suspense.html#%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84)

## äº”ã€å…¶ä»–

- å…¨å±€APIçš„ç§»é™¤

  > å°†å…¨å±€çš„APIï¼Œå³ï¼šVue.xxxè°ƒæ•´åˆ°åº”ç”¨å®ä¾‹ï¼ˆAppï¼‰ä¸Š

  |    2.xå…¨å±€APIï¼ˆVueï¼‰     |      3.xå®ä¾‹APIï¼ˆappï¼‰      |
  | :----------------------: | :-------------------------: |
  |      Vue.config.xxx      |       app.config.xxx        |
  | Vue.config.productionTip |           remove            |
  |      Vue.component       |        app.component        |
  |      Vue.directive       |        app.directive        |
  |        Vue.mixin         |          app.mixin          |
  |         Vue.use          |           app.use           |
  |      Vue.prototype       | app.config.globalProperties |
  |                          |                             |

- å…¶ä»–æ”¹å˜

  - dataå§‹ç»ˆå£°æ˜ä¸ºä¸€ä¸ªå‡½æ•°

  - è¿‡åº¦ç±»åçš„æ”¹å†™

  - ç§»é™¤keyCode

  - ç§»é™¤`v-on.native`ä¿®é¥°ç¬¦

    åŸå› ï¼š å­ç»„ä»¶ä¹Ÿéœ€è¦å£°æ˜è‡ªå®šä¹‰äº‹ä»¶

  - ç§»é™¤è¿‡æ»¤å™¨

