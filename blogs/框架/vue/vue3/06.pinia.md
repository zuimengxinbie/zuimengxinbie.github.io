---
title: piniaå­¦ä¹ 
date: 2022-07-25 00:00:00
sidebar: auto
sticky: false
permalink: /pages/vue220725/
categories: 
  - æ¡†æ¶
tags: 
  - vue

---

<p align="center">
  <img width="500" src="https://dogefs.s3.ladydaily.com/~/source/wallhaven/full/4v/wallhaven-4v9mr3.jpg"/>
</p>




> å¾…å®Œå–„ï¼Œæ„Ÿè°¢æŒ‡æ•™ğŸ’•
> <!-- more -->

## pinia

### å®‰è£…

- Vuex

  ```javascript
  npm i vuex -S
  ```

- Pinia

  ```javascript
  npm i pinia -S
  ```

### æŒ‚è½½

- Vuex

  - æ–°å»º vuexStore/index.js

    ```javascript
    import { createStore } from 'vuex'
    export default  createStore({
        // å…¨å±€state, ç±»ä¼¼vueä¸­çš„data
        state() {
            return {
                vuexmsg: 'hello vuex',
                name: 'xiaoyue'
            }
        },
        // æäº¤mutationå¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œ
        action: {},
        // ä¿®æ”¹stateå‡½æ•°
        mutations: {},
        // ç±»ä¼¼äºvueä¸­è®¡ç®—å±æ€§
        getters: {},
        // å°†storeåˆ†å‰²æˆæ¨¡å—ï¼ˆmoduleï¼‰,åº”ç”¨è¾ƒå¤§æ—¶ä½¿ç”¨
        modules: {}
    })
    ```

  - main.jså¼•å…¥

    ```javascript
    import { createApp } from 'vue'
    import App from './App.vue'
    import store from '@/store'
    createApp(App).use(store).mount('#app')
    ```

  - App.vue

    ```html
    <template>
    	<div></div>
    </template>
    <script setup>
    import { useStore } from 'vuex'
    let vuexStore = useStore()
    console.log(vuexStore.state.vuexmsg); // hello vuex
    </script>
    ```

- Pinia

  - åˆ›å»ºStore

    > srcä¸‹æ–°å»ºpiniaStore/storeA.js

    ```javascript
    import { defineStore } from 'pinia'
    export const storeA = defineStore('storeA', {
    	state: () => {
    		return {
    			piniaMsg: 'hello pinia'
    		}
    	},
    	actions: {},
        getters: {},
    })
    ```

  - main.jså¼•å…¥

    ```javascript
    import { createApp } from 'vue'
    import App from './App.vue'
    import { createPinia } from 'pinia'
    const pinia = createPinia()
    createApp(App).use(pinia).mount('#app')
    ```

  - App.vueä½¿ç”¨

    ```html
    <template>
    	<div></div>
    </template>
    <script setup>
    import { storeA } from '@/piniaStore/storeA'
    let piniaStoreA = storeA()
    console.log(piniaStoreA.piniaMsg)
    </script>
    ```

> ç†è§£

piniaä¸­æ²¡æœ‰äº†mutationså’Œmodules, pinia ä¸å¿…ä»¥åµŒå¥—ï¼ˆé€šè¿‡moduleså¼•å…¥ï¼‰çš„æ–¹å¼å¼•å…¥æ¨¡å—ï¼Œå› ä¸ºå®ƒçš„æ¯ä¸ªstoreä¾¿æ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œå¦‚storeAï¼ŒstoreB...ã€‚

åœ¨æˆ‘ä»¬ä½¿ç”¨Vuexçš„æ—¶å€™æ¯æ¬¡ä¿®æ”¹stateçš„å€¼éƒ½éœ€è¦è°ƒç”¨mutationsé‡Œçš„ä¿®æ”¹å‡½æ•°ï¼Œå› ä¸ºVuexéœ€è¦è¿½è¸ªæ•°æ®çš„å˜åŒ–ï¼Œè¿™ä½¿æˆ‘ä»¬å†™èµ·æ¥æ¯”è¾ƒç¹çã€‚

piniaåˆ™**ä¸å†éœ€è¦**mutations,åŒæ­¥å¼‚æ­¥éƒ½å¯åœ¨actionsä¸­è¿›è¡Œæ“ä½œ

### ä¿®æ”¹çŠ¶æ€

- Vuex

  > **ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œæ‰€æœ‰çš„stateå˜æ›´éƒ½åœ¨vuexå†…éƒ¨è¿›è¡Œï¼Œåœ¨actionsæ‰§è¡Œå¼‚æ­¥å‡½æ•°ï¼Œè§¦å‘mutationsä¸­çš„å‡½æ•°**

  - æ–¹å¼ä¸€

    - App.vue

      ```html
      <template>
      	<div>
              {{ vuexStore.state.vuexmsg }}
          </div>
      </template>
      <script setup>
      import { useStore } from 'vuex'
      let vuexStore = useStore()
      vuexStore.commit('setVuexMsg', 'hello juejin')
      </script>
      ```

    - vuexStore/index.js

      ```javascript
      import { createStore } from 'vuex'
      export default createStore({
      	strict: true,
        	state: {
              vuexmsg: "hello vuex"
          },
          mutations: {
              setVuexMsg(state, data) {
                  state.vuexmsg = data;
              },
          }
      })
      ```

  - æ–¹å¼äºŒ

    - App.vue

      ```html
      <template>
      	<div>
              {{ vuexStore.state.vuexmsg }}
          </div>
      </template>
      <script setup>
      import { useStore } from 'vuex'
      let vuexStore = useStore()
      vuexStore.dispatch('getState')
      </script>
      ```

    - vuexStore/index.js

      ```javascript
      import { createStore } from 'vuex'
      export default createStore({
          strict: true,
          state() {
              return {
                  vuexmsg: 'hello vuex'
              }
          },
          actions: {
            async getState({ commit }) {
                // const result = await xxx å‡è®¾è¿™é‡Œè¿›è¡Œäº†è¯·æ±‚å¹¶æ‹¿åˆ°äº†è¿”å›å€¼
                commit('setVuexMsg', "hello juejin")
            }  
          },
          mutations: {
              setVuexMsg(state, data) {
                  state.vuexmsg = data;
              }
          }
      })
      ```

- pinia

  > **ç›¸å¯¹äºVuexï¼ŒPiniaæ˜¯å¯ä»¥ç›´æ¥ä¿®æ”¹çŠ¶æ€çš„ï¼Œå¹¶ä¸”è°ƒè¯•å·¥å…·èƒ½å¤Ÿè®°å½•åˆ°æ¯ä¸€æ¬¡stateçš„å˜åŒ–**

  - ç›´æ¥ä¿®æ”¹ App.vue

    ```html
    <template>
    	<div>
            {{ piniaStoreA.piniaMsg }}
        </div>
    </template>
    <script setup>
    import { storeA } from '@/piniaStore/storeA'
    let piniaStoreA = storeA()
    console.log(piniaStoreA.piniaMsg) // hello pinia
    
    piniaStoreA.piniaMsg = 'hello juejin'
    console.log(piniaStoreA.piniaMsg); // hello juejin    
    </script>
    ```

  - $patch

    > å› ä¸ºæ²¡æœ‰äº†mutations

    ä½¿ç”¨$patchæ–¹æ³•å¯ä»¥ä¿®æ”¹å¤šä¸ªstateçš„å€¼ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨piniaStore/storeA.jsä¸­çš„stateå¢åŠ ä¸€ä¸ªname

    ```javascript
    import { defineStore } from 'pinia'
    export const stroreA = defineStore("storeA", {
        state: () => {
            return {
                piniaMsg: 'hello pinia',
                name: 'xiaoyue'
            }
        },
        getters: {},
        actions: {}
    })
    ```

    ç„¶åæˆ‘ä»¬åœ¨App.vueä¸­è¿›è¡Œä¿®æ”¹è¿™ä¸¤ä¸ªstate

    ```javascript
    import { storeA } from '@/piniaStore/storeA'
    let piniaStoreA = storeA()
    console.log(piniaStoreA.name) // xiaoyue
    piniaStoreA.$patch({
    	piniaMsg: 'hello juejin',
    	name: 'daming'
    })
    console.log(piniaStoreA.name) // daming
    
    // å¦ä¸€ç§å†™æ³•
    cartStore.$patch((state) => {
        state.name = 'daming'
        state.piniaMsg = 'hello juejin'
    })
    ```

  - åœ¨actionsä¸­è¿›è¡Œä¿®æ”¹

    > ä¸åŒäºVuexçš„æ˜¯ï¼ŒPiniaå»æ‰äº†mutations, æ‰€ä»¥åœ¨actionsä¸­ä¿®æ”¹stateå°±è¡ŒVuexåœ¨mutationsä¿®æ”¹stateä¸€æ ·ï¼Œå®ç°æ•´ä¸ªæµç¨‹éƒ½æ˜¯åœ¨çŠ¶æ€ç®¡ç†å™¨å†…éƒ¨ã€‚ä¾¿äºç®¡ç†

    ```javascript
    import { defineSotre } from "pinia"
    export const storeA = defineStore("storeA", {
        state: () => {
            return {
                piniaMs: 'hello pinia',
                name: 'xiao yue'
            }
        },
        actions: {
            setName(data) {
                this.name = data
            }
        }
    })
    ```

    åœ¨ç»„ä»¶App.vueä¸­è°ƒç”¨ä¸éœ€è¦å†ä½¿ç”¨dispatchå‡½æ•°ï¼Œç›´æ¥è°ƒç”¨storeçš„æ–¹æ³•å³å¯

    ```javascript
    import { storeA } from '@/piniaStore/storeA'
    let piniaStoreA = storeA()
    piniaStoreA.setName('daming')
    ```

  - é‡ç½®çŠ¶æ€ä¸ºåˆå§‹å€¼

    ```javascript
    import { storeA } from '@/piniaStore/storeA'
    let piniaStoreA = storeA()
    piniaStoreA.$reset()
    ```

### Piniaè§£æ„

> es6çš„è§£æ„å† v3ä¸­ä¼šå¤±å»å“åº”å¼ï¼Œ è§£å†³ **storeToRefs**

```html
<template>
	<div>
        {{ name }}
    </div>
</template>
<script setup>
import { storeA } from '@/piniaStore/storeA'
import { storeToRefs } from 'pinia
let piniaStoreA = storeA()
let { piniaMsg, name } = storeToRefs(piniaStoreA)
piniaStoreA.$patch({name: 'daming'})
</script>
```

### getters

> Vuexä¸­çš„getterså’ŒPiniaä¸­çš„gettersç”¨æ³•æ˜¯ä¸€è‡´çš„ï¼Œç”¨äºè‡ªåŠ¨ç›‘å¬å¯¹åº”stateçš„å˜åŒ–

### modules

### æ•°æ®æŒä¹…åŒ–

- èƒŒæ™¯

  é¡µé¢åˆ·æ–°åï¼Œæƒ³ä¿å­˜é¡µé¢ä¸­æœªä¿å­˜çš„æ•°æ®ï¼›

  1. ä¹‹å‰ï¼š ä¹ æƒ¯å­˜æ”¾äºæµè§ˆå™¨çš„sessionStorageå’ŒlocalStorageä¸­
  2. Vuexå‡ºç°ï¼š ä½¿ç”¨Vuex
     - ä¼˜åŠ¿ï¼š ç›¸æ¯”sessionStore,å­˜å‚¨æ•°æ®æ›´å®‰å…¨ï¼ˆ sessionStorageå¯ä»¥è¢«æ§åˆ¶å°çœ‹åˆ° ï¼‰
     - åŠ£åŠ¿ï¼š åœ¨F5åˆ·æ–°é¡µé¢åï¼Œvuexä¼šé‡æ–°æ›´æ–°stateï¼Œæ‰€ä»¥ï¼Œå­˜å‚¨çš„æ•°æ®ä¼šä¸¢å¤±

- è§£å†³åŠ£åŠ¿

  > åŸç†ä¹Ÿæ˜¯ç»“åˆæœ¬åœ°å­˜å‚¨åšåˆ°çš„æ•°æ®æŒä¹…åŒ–

  vuex: ä½¿ç”¨æ’ä»¶ vuex-persistedstate

  pinia: ä½¿ç”¨æ’ä»¶ pinia-plugin-persistedstate

  - å°è£…(piniaæŒä¹…åŒ–å‚æ•°é…ç½®)

    ```javascript
    import { PersistedStateOptions } from "pinia-plugin-persistedstate"
    const piniaPersistConfig = (key: string) => {
        const persist: PersistedStateOptions = {
            key,
            storage: window.sessionStorage
        }
    }
    ```

    

## å‚è€ƒæ–‡çŒ®

[ä¸€æ–‡è§£æPinia å’Œ Vuex](https://mp.weixin.qq.com/s/GUK7eUo4ua23sWVJ8ysUsQ)

